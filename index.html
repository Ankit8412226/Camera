<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Camera Capture & Local Storage</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
    }

    h1 {
      text-align: center;
      color: #333;
      margin-bottom: 30px;
      font-size: 2.5rem;
      font-weight: 300;
    }

    .camera-section {
      display: flex;
      flex-wrap: wrap;
      gap: 30px;
      margin-bottom: 40px;
    }

    .camera-container {
      flex: 1;
      min-width: 300px;
      text-align: center;
    }

    .preview-container {
      flex: 1;
      min-width: 300px;
    }

    #videoElement {
      width: 100%;
      max-width: 400px;
      height: 300px;
      border-radius: 15px;
      background: #000;
      object-fit: cover;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
    }

    #canvas {
      display: none;
    }

    .controls {
      margin: 20px 0;
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
    }

    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 25px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      font-weight: 500;
    }

    .btn-primary {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: white;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
    }

    .btn-success {
      background: linear-gradient(135deg, #56ab2f, #a8e6cf);
      color: white;
    }

    .btn-success:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(86, 171, 47, 0.4);
    }

    .btn-danger {
      background: linear-gradient(135deg, #ff6b6b, #ee5a52);
      color: white;
    }

    .btn-danger:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(238, 90, 82, 0.4);
    }

    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
      transform: none !important;
    }

    .camera-toggle {
      margin: 10px 0;
    }

    .camera-toggle select {
      padding: 8px 12px;
      border-radius: 8px;
      border: 2px solid #ddd;
      font-size: 0.9rem;
    }

    .mobile-notice {
      background: rgba(102, 126, 234, 0.1);
      border: 1px solid rgba(102, 126, 234, 0.3);
      border-radius: 10px;
      padding: 15px;
      margin: 20px 0;
      color: #667eea;
      display: none;
    }

    .status {
      text-align: center;
      padding: 15px;
      border-radius: 10px;
      margin: 15px 0;
      font-weight: 500;
    }

    .status.success {
      background: rgba(86, 171, 47, 0.1);
      color: #56ab2f;
      border: 1px solid rgba(86, 171, 47, 0.3);
    }

    .status.error {
      background: rgba(255, 107, 107, 0.1);
      color: #ff6b6b;
      border: 1px solid rgba(255, 107, 107, 0.3);
    }

    .status.info {
      background: rgba(102, 126, 234, 0.1);
      color: #667eea;
      border: 1px solid rgba(102, 126, 234, 0.3);
    }

    .gallery {
      margin-top: 40px;
    }

    .gallery h2 {
      color: #333;
      margin-bottom: 20px;
      text-align: center;
    }

    .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 20px;
    }

    .gallery-item {
      position: relative;
      border-radius: 15px;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }

    .gallery-item:hover {
      transform: scale(1.05);
    }

    .gallery-item img {
      width: 100%;
      height: 150px;
      object-fit: cover;
    }

    .gallery-item-overlay {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(transparent, rgba(0, 0, 0, 0.8));
      color: white;
      padding: 15px 10px 10px;
      font-size: 0.8rem;
    }

    .gallery-item-actions {
      position: absolute;
      top: 10px;
      right: 10px;
      display: flex;
      gap: 5px;
    }

    .action-btn {
      background: rgba(255, 255, 255, 0.9);
      border: none;
      border-radius: 50%;
      width: 30px;
      height: 30px;
      cursor: pointer;
      font-size: 0.8rem;
      transition: all 0.3s ease;
    }

    .action-btn:hover {
      background: white;
      transform: scale(1.1);
    }

    .storage-info {
      text-align: center;
      margin: 20px 0;
      padding: 15px;
      background: rgba(102, 126, 234, 0.1);
      border-radius: 10px;
      color: #667eea;
    }

    .privacy-notice {
      background: rgba(255, 193, 7, 0.1);
      border: 1px solid rgba(255, 193, 7, 0.3);
      border-radius: 10px;
      padding: 15px;
      margin: 20px 0;
      color: #856404;
    }

    .privacy-notice h3 {
      margin-bottom: 10px;
      color: #856404;
    }

    @media (max-width: 768px) {
      .mobile-notice {
        display: block;
      }

      .camera-section {
        flex-direction: column;
      }

      .controls {
        flex-direction: column;
        align-items: center;
      }

      .btn {
        width: 200px;
      }

      .gallery-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      }

      #videoElement {
        height: 250px;
      }
    }
  </style>
</head>

<body>
  <div class="container">
    <h1>üì∏ Camera Capture & Local Storage</h1>

    <div class="privacy-notice">
      <h3>üîí Privacy Notice</h3>
      <p>This application will request access to your camera with your consent. All captured images are stored locally
        in your browser and never sent to any server. You have full control over your images.</p>
    </div>

    <div class="mobile-notice">
      <h3>üì± Mobile Users</h3>
      <p>On mobile devices, clicking "Start Camera" will open your device's camera app with optimized settings for the
        best photo quality.</p>
    </div>

    <div class="camera-section">
      <div class="camera-container">
        <h3 style="margin-bottom: 15px; color: #333;">üìπ Camera Feed</h3>
        <video id="videoElement" autoplay muted playsinline></video>
        <canvas id="canvas"></canvas>

        <div class="camera-toggle">
          <label for="cameraSelect">Camera: </label>
          <select id="cameraSelect">
            <option value="user">Front Camera</option>
            <option value="environment">Back Camera</option>
          </select>
        </div>

        <div class="controls">
          <button id="startCamera" class="btn btn-primary">Start Camera</button>
          <button id="capturePhoto" class="btn btn-success" disabled>üì∑ Capture Photo</button>
          <button id="stopCamera" class="btn btn-danger" disabled>Stop Camera</button>
        </div>

        <div id="status" class="status" style="display: none;"></div>
      </div>

      <div class="preview-container">
        <h3 style="margin-bottom: 15px; color: #333;">üñºÔ∏è Latest Capture</h3>
        <div id="latestCapture" style="text-align: center; color: #666;">
          No photo captured yet
        </div>
      </div>
    </div>

    <div class="storage-info">
      <p><strong>Storage:</strong> <span id="storageCount">0</span> photos stored locally</p>
      <button id="clearAll" class="btn btn-danger" style="margin-top: 10px;">Clear All Photos</button>
    </div>

    <div class="gallery">
      <h2>üìÅ Stored Photos</h2>
      <div id="galleryGrid" class="gallery-grid"></div>
    </div>
  </div>

  <script>
    let videoElement = document.getElementById('videoElement');
    let canvas = document.getElementById('canvas');
    let ctx = canvas.getContext('2d');
    let stream = null;
    let photoCount = 0;

    const startCameraBtn = document.getElementById('startCamera');
    const capturePhotoBtn = document.getElementById('capturePhoto');
    const stopCameraBtn = document.getElementById('stopCamera');
    const cameraSelect = document.getElementById('cameraSelect');
    const statusDiv = document.getElementById('status');
    const latestCaptureDiv = document.getElementById('latestCapture');
    const galleryGrid = document.getElementById('galleryGrid');
    const storageCountSpan = document.getElementById('storageCount');
    const clearAllBtn = document.getElementById('clearAll');

    // Detect mobile device
    const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);

    // Load existing photos from localStorage on page load
    window.addEventListener('load', () => {
      loadStoredPhotos();
      updateStorageCount();
    });

    // Start camera with mobile optimization
    startCameraBtn.addEventListener('click', async () => {
      try {
        showStatus('Requesting camera access...', 'info');

        const selectedCamera = cameraSelect.value;

        // Mobile-optimized camera constraints
        const constraints = {
          video: {
            facingMode: selectedCamera,
            width: isMobile ? { ideal: 1920, max: 1920 } : { ideal: 1280 },
            height: isMobile ? { ideal: 1080, max: 1080 } : { ideal: 720 },
            aspectRatio: isMobile ? { ideal: 16 / 9 } : { ideal: 16 / 9 }
          }
        };

        // Additional mobile-specific settings
        if (isMobile) {
          constraints.video.focusMode = 'continuous';
          constraints.video.exposureMode = 'continuous';
          constraints.video.whiteBalanceMode = 'continuous';
        }

        stream = await navigator.mediaDevices.getUserMedia(constraints);
        videoElement.srcObject = stream;

        startCameraBtn.disabled = true;
        capturePhotoBtn.disabled = false;
        stopCameraBtn.disabled = false;
        cameraSelect.disabled = true;

        if (isMobile) {
          showStatus('Mobile camera activated with high quality settings! Tap capture when ready.', 'success');
        } else {
          showStatus('Camera started successfully! You can now capture photos.', 'success');
        }

      } catch (error) {
        console.error('Error accessing camera:', error);

        if (error.name === 'NotAllowedError') {
          showStatus('Camera access denied. Please allow camera permissions and try again.', 'error');
        } else if (error.name === 'NotFoundError') {
          showStatus('No camera found on this device.', 'error');
        } else if (error.name === 'NotReadableError') {
          showStatus('Camera is being used by another application.', 'error');
        } else {
          showStatus('Error: Unable to access camera. Please ensure you have granted camera permissions.', 'error');
        }
      }
    });

    // Camera selection change
    cameraSelect.addEventListener('change', () => {
      if (stream) {
        // Stop current stream and restart with new camera
        stopCameraBtn.click();
        setTimeout(() => {
          startCameraBtn.click();
        }, 500);
      }
    });

    // Capture photo with mobile optimization
    capturePhotoBtn.addEventListener('click', () => {
      if (stream) {
        // Set canvas size to match video
        canvas.width = videoElement.videoWidth;
        canvas.height = videoElement.videoHeight;

        // Draw video frame to canvas
        ctx.drawImage(videoElement, 0, 0, canvas.width, canvas.height);

        // For mobile devices, use higher quality JPEG
        const imageFormat = isMobile ? 'image/jpeg' : 'image/png';
        const imageQuality = isMobile ? 0.92 : undefined;

        const dataURL = canvas.toDataURL(imageFormat, imageQuality);

        // Save to memory (instead of localStorage for Claude.ai compatibility)
        savePhoto(dataURL);

        // Update display
        updateLatestCapture(dataURL);

        if (isMobile) {
          showStatus('High-quality photo captured and saved!', 'success');
          // Haptic feedback on mobile (if supported)
          if (navigator.vibrate) {
            navigator.vibrate(100);
          }
        } else {
          showStatus('Photo captured and saved locally!', 'success');
        }

        // Add to gallery
        addToGallery(dataURL, new Date());
      }
    });

    // Stop camera
    stopCameraBtn.addEventListener('click', () => {
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
        stream = null;
        videoElement.srcObject = null;

        startCameraBtn.disabled = false;
        capturePhotoBtn.disabled = true;
        stopCameraBtn.disabled = true;
        cameraSelect.disabled = false;

        showStatus('Camera stopped.', 'info');
      }
    });

    // Clear all photos
    clearAllBtn.addEventListener('click', () => {
      if (confirm('Are you sure you want to delete all stored photos? This cannot be undone.')) {
        clearAllPhotos();
        showStatus('All photos cleared from storage.', 'info');
      }
    });

    // In-memory storage for photos (Claude.ai compatible)
    let photoStorage = [];

    // Save photo to memory
    function savePhoto(dataURL) {
      try {
        const timestamp = new Date().toISOString();
        const photoData = {
          image: dataURL,
          timestamp: timestamp,
          id: 'photo_' + Date.now()
        };

        photoStorage.push(photoData);
        photoCount++;
        updateStorageCount();

      } catch (error) {
        console.error('Error saving photo:', error);
        showStatus('Error: Unable to save photo.', 'error');
      }
    }

    // Load stored photos
    function loadStoredPhotos() {
      galleryGrid.innerHTML = '';

      // Sort by timestamp (newest first)
      const sortedPhotos = [...photoStorage].sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));

      sortedPhotos.forEach(photo => {
        addToGallery(photo.image, new Date(photo.timestamp), photo.id);
      });
    }

    // Add photo to gallery
    function addToGallery(dataURL, timestamp, photoId) {
      const galleryItem = document.createElement('div');
      galleryItem.className = 'gallery-item';
      galleryItem.innerHTML = `
        <img src="${dataURL}" alt="Captured photo">
        <div class="gallery-item-overlay">
          ${timestamp.toLocaleString()}
        </div>
        <div class="gallery-item-actions">
          <button class="action-btn" onclick="downloadPhoto('${dataURL}', '${timestamp.getTime()}')" title="Download">üíæ</button>
          <button class="action-btn" onclick="deletePhoto('${photoId || 'photo_' + timestamp.getTime()}')" title="Delete">üóëÔ∏è</button>
        </div>
      `;

      galleryGrid.insertBefore(galleryItem, galleryGrid.firstChild);
    }

    // Download photo
    function downloadPhoto(dataURL, timestamp) {
      const link = document.createElement('a');
      link.download = `captured_photo_${timestamp}.${isMobile ? 'jpg' : 'png'}`;
      link.href = dataURL;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }

    // Delete single photo
    function deletePhoto(photoId) {
      if (confirm('Delete this photo?')) {
        photoStorage = photoStorage.filter(photo => photo.id !== photoId);
        loadStoredPhotos();
        updateStorageCount();
        showStatus('Photo deleted.', 'info');
      }
    }

    // Clear all photos
    function clearAllPhotos() {
      photoStorage = [];
      galleryGrid.innerHTML = '';
      latestCaptureDiv.innerHTML = 'No photo captured yet';
      photoCount = 0;
      updateStorageCount();
    }

    // Update storage count
    function updateStorageCount() {
      storageCountSpan.textContent = photoStorage.length;
    }

    // Update latest capture display
    function updateLatestCapture(dataURL) {
      latestCaptureDiv.innerHTML = `
        <img src="${dataURL}" style="max-width: 100%; max-height: 200px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2);" alt="Latest capture">
        <p style="margin-top: 10px; color: #666; font-size: 0.9rem;">Captured at ${new Date().toLocaleString()}</p>
      `;
    }

    // Show status message
    function showStatus(message, type) {
      statusDiv.textContent = message;
      statusDiv.className = `status ${type}`;
      statusDiv.style.display = 'block';

      setTimeout(() => {
        statusDiv.style.display = 'none';
      }, 5000);
    }

    // Handle browser compatibility
    if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
      showStatus('Error: Your browser does not support camera access.', 'error');
      startCameraBtn.disabled = true;
    }

    // Mobile-specific optimizations
    if (isMobile) {
      // Prevent zoom on double tap for better UX
      document.addEventListener('dblclick', function (e) {
        e.preventDefault();
      });

      // Default to back camera on mobile
      cameraSelect.value = 'environment';

      // Add fullscreen support for mobile
      if (videoElement.requestFullscreen) {
        videoElement.addEventListener('dblclick', () => {
          videoElement.requestFullscreen();
        });
      }
    }

    // Clean up on page unload
    window.addEventListener('beforeunload', () => {
      if (stream) {
        stream.getTracks().forEach(track => track.stop());
      }
    });

    // Handle visibility changes (mobile tab switching)
    document.addEventListener('visibilitychange', () => {
      if (document.hidden && stream) {
        // Pause video on mobile to save battery
        if (isMobile) {
          videoElement.pause();
        }
      } else if (!document.hidden && stream) {
        // Resume video
        if (isMobile) {
          videoElement.play();
        }
      }
    });
  </script>
</body>

</html>
